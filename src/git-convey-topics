#!/bin/sh
# /**
#  * <div class="p">
#  *   Script to implement 'topics' management within git. This is an
#  *   extension defined by <a
#  *   href="http://dogfoodsoftware.com/documentation/git-convey">Git
#  *   Convey</a>.
#  * </div>
#  * <div id="Implementation" data-perspective="implementation" class="grid_12 blurbSummary">

resource_usage() {
    if [ x"$1" != x"" ]; then
	echo $1 >&2
	echo >&2
    fi

    echo "usage: git convey topics [list|start|join|commit|delete|done|help [topic or topic pattern]] "
    echo
    echo "Available actions:"
    echo "   list      Lists open topics. This is the default action."
    echo "   start     Starts/opens a topic branch."
    echo "   join      Joins an existing topic branch."
    echo "   commit    Commits changes to a topic branch."
    echo "   delete    Deletes the local topic branch."
    echo "   done      Submits a topic branch."
    echo "   help      Print this help."
    echo
    global_help
}

resource_help() {
    if [ $# -lt 1 ]; then
	resource_usage
    else
	ACTION="$1"; shift
	case "$ACTION" in
	    list)
		echo "Lists the topic branches active in the current repository."
		;;
	    start)
		echo "Creates a new topic branch and checks it out. The current branch must be"
		echo "'master', which will be updated and used as the source of the new branch."
		echo "The branch must not already exist and the branch name must start with"
		echo "'task-', 'bugfix-', or 'hotfix-' as appropriate."
		;;
	    join)
		echo "Checks and and updates an existing topic branch."
		;;
	    commit)
		echo "Commits local changes to the topic branch and publishes the changes to the"
		echo "shared repository."
		;;
	    delete)
		echo "Deletes the named topic branch from the local repository. To submit a topic"
		echo "for inclusion back to the source, use 'done'."
		;;
	    done)
		echo "Submits the topic branch for inclusion back to the source branch."
		;;
	    help)
		echo "Meta-help... you're blowing my mind."
		echo
		resource_usage;;
	    *)
		resource_usage "Unknown action: '$ACTION'."
		exit 1;
	esac
    fi
}

resource_do() {
    if [ $# -lt 1 ]; then
	ACTION="list"
    else
	ACTION="$1"; shift
    fi
    if [ $# -ge 1 ]; then
	BRANCH_NAME="$1"; shift
    fi

    case "$ACTION" in
	list)
	    list_resources topic;;
	start)
	    start_branch 'topic' "$BRANCH_NAME";;
	join)
	    echo join;;
	commit)
	    echo commit;;
	delete)
	    echo delete;;
	done)
	    echo done;;
	help)
	    ACTION="$BRANCH_NAME"
	    if [ x"$ACTION" == x"" ]; then
		resource_usage
	    else
		resource_help "$ACTION"
	    fi
	    ;;
	*)
	    resource_usage "Unknown action: '$ACTION'."
	    exit 1;
    esac
}

check_new_branch_name() {
    TOPIC_NAME="$1"
    # No particular tests at this time.
}

#  * </div><!-- #Implementation.blurbSummary -->
