resource_usage() {
    if [ x"$1" != x"" ]; then
	echo $1 >&2
	echo >&2
    fi

    echo "usage: con init <source repo name> [<staging dir>]"
    echo
    echo "Used to initialize a new origin repository for conveyor-workflows. This is a"
    echo "standard git repository with the 'master' branch pre-populated with"
    echo "a README.repo file."
    echo
    echo "Use 'con sync' to checkout a local working directory."
}

resource_do() {
    if [ $# -lt 1 ] || [ $# -gt 2 ]; then
	resource_usage "Unknown usage for 'con init'."
	exit 1
    fi

    local REPO_NAME="$1"; shift

    generic_name_tests "$REPO_NAME"

    # Create the repo.
    mkdir ${REPO_NAME}.git
    cd ${REPO_NAME}.git
    # Notice this is not a bare repo; we want to be able to do merges and
    # other git operations from the repo.
    git init --quiet .
    cat <<EOF > README.repo
This is a conveyor-workflows repository and is intended for use with conveyor-workflows
porcelain. For further information, please refer to:

http://dogfoodsoftware.com/documentation/conveyor-workflows
EOF
    git add README.repo
    git commit --quiet -m "Initialized conveyor-workflows repo with README.repo file."
    # For some reason, the 'push' output comes out ot stderr...
    cd ..

    # TODO: use 'shell-echo.sh' functions for quite output.
    echo "'$REPO_NAME' initialized."
}
